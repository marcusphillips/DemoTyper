<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <script src="http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
  <style type="text/css" media="screen">
    body {
        overflow: hidden;
    }
    
    #editor { 
        margin: 0;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }
  </style>
</head>
<body>

<textarea id="hijacker" style="opacity:0%;z-index:5;"></textarea>
<button id="playback" style="z-index:5; color:blue;top:5px;right:20px;position:absolute;font-size:12pt;">Playback Mode!</button>
<pre id="editor"></pre>

<script src="src/ace-uncompressed-noconflict.js" type="text/javascript" charset="utf-8"></script>
<script>
var editor, eventStream = [], allEvents = [];
var newEventStream = [];
var script;
var speed = 50;

var getRedos = function(){
  return editor.session.getUndoManager().$redoStack;
}
var getUndos = function(){
  return editor.session.getUndoManager().$undoStack;
}

var play = function(){
  editor.session.getUndoManager().$redoStack = JSON.parse(script);
  animateRedos();
};

var animateRedos = function(){
  getRedos().length && setTimeout(function(){
    editor.redo();
    animateRedos();
  }, speed);
};

var record = function(){
  while(editor.session.getUndoManager().$undoStack.length){
    editor.undo();
  }
  console.log(script = JSON.stringify(editor.session.getUndoManager().$redoStack));
};

window.onload = function() {
    editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    editor.getSession().setMode("ace/mode/javascript");
  $('#playback').click(function(){
    record();
    $('#hijacker').focus();
    $('#playback').hide();
  });
  $('#hijacker').keydown(function(){
    console.log('hijacking');
    editor.redo();
  });
};

</script>

</body>
</html>
